@page "/Edition/{fileName}"
@using Microsoft.Extensions.Localization
@using System.Globalization
@inject IStringLocalizer<Edition> Localizer
@inject IJSRuntime JSRuntime
@inject IConfiguration Configuration

@* <link rel="stylesheet" href="http://localhost:8081/exist/apps/HasidicStoriesServer/resources/css/theme.css" /> *@

<pb-page endpoint=@(Configuration["endpointURL"] + "/HasidicStoriesServer")
         data-template="pages:pb-page" unresolved="unresolved">
    <pb-document id="document1" path=@(fileName + ".xml") odd="Stories" view="page"></pb-document>
    <app-toolbar class="toolbar" sticky="sticky">
        <paper-button id="tocToggle" class="toc-toggle">
            <iron-icon icon="icons:view-list" />
            <span class="clsToolbar">@Localizer["stories"]</span>
        </paper-button>
        <pb-navigation emit="transcription" keyboard="left" subscribe="transcription" direction="backward" unit="div">
            <paper-button>
                <iron-icon icon="icons:file-upload" />
                <span class="clsToolbar">@Localizer["back"]</span>
            </paper-button>
        </pb-navigation>
        <pb-view src="document1" xpath="//teiHeader/fileDesc/titleStmt/title[@@type='main']" view="single" disable-history="">
            <pb-param name="header" value="short" load-css="/resources/css/editionTitle.css" />
        </pb-view>
        <pb-navigation emit="transcription" keyboard="right" subscribe="transcription" direction="forward" unit="div">
            <paper-button icon="icons:chevron-down">
                <span class="clsToolbar">@Localizer["forward"]</span>
                <iron-icon icon="icons:file-download" />
            </paper-button>
        </pb-navigation>
    </app-toolbar>
    <pb-drawer toggle="tocToggle" class="toc" emit="toc" subscribe="transcription" position="@tocPosition">
        <div class="drawer-content">
            <h3>
                @Localizer["content"]
            </h3>
            <pb-load id="toc" url="api/document/{doc}/edition_contents?target=transcription&amp;icons=true" expand="expand" src="document1" subscribe="toc" load-once="load-once"><pb-i18n key="dialogs.loading">Loading</pb-i18n></pb-load>
        </div>
    </pb-drawer>
    <br />
    <div class="content-body">
        <pb-view id="view1" src="document1" column-separator=".tei-cb" append-footnotes="append-footnotes" subscribe="transcription" emit="transcription" wait-for="#facsimile" animation disable-history />
        @* <pb-facsimile id="facsimile" type="image" base-uri="https://teipub9.dh-dev.com/exist/apps/HasidicImages/" default-zoom-level="0" *@
        <pb-facsimile id="facsimile" type="image" base-uri=@(Configuration["endpointURL"] + "/HasidicImages/") default-zoom-level="0"
                      show-navigation-control="show-navigation-control" subscribe="transcription" show-home-control="" />
    </div>
</pb-page>

@code {
    [Parameter] public string fileName { get; set; }
    string tocPosition = "";

    protected override void OnInitialized()
    {
        if (CultureInfo.CurrentCulture.Name == "he-IL") tocPosition = "right";
        else tocPosition = "left";
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            string cssUrl = "";
            if (CultureInfo.CurrentCulture.Name == "he-IL")
                cssUrl = Configuration["endpointURL"] + "/HasidicStoriesServer/resources/css/theme_rtl.css";
            else
                cssUrl = Configuration["endpointURL"] + "/HasidicStoriesServer/resources/css/theme.css";

            await JSRuntime.InvokeVoidAsync("loadCssFile", cssUrl);
        }
    }
}

