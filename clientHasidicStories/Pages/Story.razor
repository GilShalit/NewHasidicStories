@page "/Story/{fileName}/{storyId}"
@using Microsoft.Extensions.Localization
@using System.Text.Json
@inject IStringLocalizer<Story> Localizer
@inject IJSRuntime JS
@inject IConfiguration Configuration

<div class="controlsContainer">
    <Row>
        @if(showMap)
        {
            <Column ColumnSize="@myColumnSize" >
                <Map />
            </Column>
        }
        <Column ColumnSize="@myColumnSize" Style="direction:rtl">
            <StoryTEI fileName="@fileName" storyId="@storyId" />
        </Column>
        <Column ColumnSize="@myColumnSize">
            <Row></Row>
            <Row Margin="Margin.Is2.FromTop"></Row>
            <Row Margin="Margin.Is2.FromTop"></Row>
        </Column>
    </Row>
</div>

@code {
    [Parameter] public string fileName { get; set; }
    [Parameter] public string storyId { get; set; }
    private Blazorise.IFluentColumn myColumnSize;
    private bool showMap; 

    protected override async Task OnInitializedAsync()
    {
        var stateJson = await JS.InvokeAsync<string>("localStorage.getItem", "places");
        if (!string.IsNullOrEmpty(stateJson))
        {
            clsPlaces places = JsonSerializer.Deserialize<clsPlaces>(stateJson, new JsonSerializerOptions { IncludeFields = true });

            List<string> storyPlaceIds = places.storyPlaceIds(storyId);
            showMap = storyPlaceIds.Count > 0;
            if (showMap) myColumnSize = ColumnSize.Is4;
            else myColumnSize = ColumnSize.Is6;
        }
    }
}
