@using System.IO;
@inject NavigationManager navigationManager
<Div Class="listControl">
    <h3>@caption</h3>
    @if (globalService.EditionFiles!=null && globalService.EditionFiles.Count > 0)
    {
        <TreeView Nodes="globalService.EditionFiles"
                  GetChildNodes="@(item => item.children)"
                  HasChildNodes="@(item => item.children?.Any() == true)"
                  SelectionMode="TreeViewSelectionMode.Multiple"
                  @bind-SelectedNodes="selectedNodes">
            <NodeContent>
                <Icon Name="IconName.Book" />
                <Button Class="linkStyle" @onclick="() => NavigateToFile(context.name)">@context.title</Button>
            </NodeContent>
        </TreeView>
    }
    else
    {
        <p>Loading...</p>
    }
</Div>

@code {
    [Inject] GlobalService globalService { get; set; }
    [Parameter] public string caption { get; set; }
    IList<clsEditionFile> selectedNodes = new List<clsEditionFile>();

    protected override void OnInitialized()
    {
        globalService.OnGlobalEditionsChanged += HandleGlobalEditionsChange;
    }
    public void Dispose()
    {
        globalService.OnGlobalEditionsChanged -= HandleGlobalEditionsChange;
    }
    private void HandleGlobalEditionsChange()
    {

        StateHasChanged();
    }
    private void NavigateToFile(string fileName)
    {
        if (!globalService.TEILoadedOnce) navigationManager.NavigateTo($"/Edition/{fileName}",false);
        else navigationManager.NavigateTo($"/Edition/{fileName}", true);
    }

}
