@using System.Text.Json
<Div id="mapDiv" Class="listControl" style="width: 100%!important;height:100%!important;" />

@code {
    //https://docs.maptiler.com/sdk-js/examples/geojson-markers/
    [Inject] GlobalService globalService { get; set; }
    [Inject] IJSRuntime JS { get; set; }
    private Action ChangeDelegate;//so the Handle method can be unsubscribed

    protected override async Task OnInitializedAsync()
    {
        ChangeDelegate = async () => await HandleGlobalPointsChange();
        globalService.OnGlobalPointsChanged += ChangeDelegate;
    }
    public async Task Dispose()
    {
        globalService.OnGlobalPointsChanged -= ChangeDelegate;
    }
    private async Task HandleGlobalPointsChange()
    {
        await DrawMap();
    }
    private async Task DrawMap()
    {

        var center = globalService.Points.data.Center;

        await JS.InvokeVoidAsync("showMap", center, "mapDiv", globalService.Points);
        StateHasChanged();
    }

}
