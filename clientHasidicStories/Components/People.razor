<Div Class="listControl">
    <h3>@caption</h3>
    @if (globalService.Persons != null && globalService.Persons.Count > 0 && globalService.Persons.hasNames)
    {
        <TreeView Nodes="globalService.Persons"
                  TNode="clsPerson"
                  GetChildNodes="@(item => item.children)"
                  HasChildNodes="@(item => item.children?.Any() == true)"
                  SelectionMode="TreeViewSelectionMode.Multiple"
                  SelectedNodesChanged="selectedNodesChanged">

            <NodeContent>
                <Icon Name="IconName.IdCard" />
                @context.name
            </NodeContent>
        </TreeView>
    }
    else
    {
        <p>Loading...</p>
    }
</Div>



@code {
    [Inject] GlobalService globalService { get; set; }
    [Parameter] public string caption { get; set; }
    IList<clsPerson> expandedNodes = new List<clsPerson>();
    protected override void OnInitialized()
    {
        globalService.OnGlobalPersonsChanged += HandleGlobalPersonsChange;
    }
    public void Dispose()
    {
        globalService.OnGlobalThemesChanged -= HandleGlobalPersonsChange;
    }
    private void HandleGlobalPersonsChange()
    {
        StateHasChanged();
    }
    private void selectedNodesChanged(IList<clsPerson> nodes)
    {
        foreach (clsPerson node in globalService.Persons)
        {
            node.selected = nodes.Contains(node);
        }
        globalService.diplayStories = Utils.displayStories(globalService);
    }
}
